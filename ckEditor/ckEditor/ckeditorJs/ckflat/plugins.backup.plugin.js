CKEDITOR.plugins.add("backup",{lang:"en",init:function(a){a.on("instanceReady",function(){var c=document.createElement("div"),h=0,b="backup_"+a.name,e=!0,i="";c.setAttribute("style","display:inline-block; margin-left:10px;position:relative;margin-top:5px;overflow:hidden;float:right;");void 0==localStorage.getItem(b)&&localStorage.setItem(b,"{}");var m=function(a){var a=new Date(parseInt(a)),b=function(a){10>a&&(a="0"+a);return a};return a.getHours()+"."+b(a.getMinutes())+"."+b(a.getSeconds())};a.backup=
function(d){var j=!1,c=(new Date).getTime(),f={};if("del"!=d){var g=a.getSnapshot();""!=g&&(localStorage.getItem(b)&&i&&g!=i)&&(f=JSON.parse(localStorage.getItem(b)),f[c]=g,localStorage.setItem(b,JSON.stringify(f)),j=!0)}else confirm(a.lang.backup.mess1)&&(localStorage.setItem(b,"{}"),j=!0);if(j||e){e&&localStorage.getItem(b)&&(f=JSON.parse(localStorage.getItem(b)));var d="<option>---</option>",k;for(k in f)d+='<option value="'+k+'">'+m(k)+"</option>";h.setHtml(d);e=!1}i=g};a.restore=function(){var d=
a.getSnapshot(),c=h.getValue(),e=JSON.parse(localStorage.getItem(b));void 0!=e[c]&&(""==d||confirm(a.lang.backup.mess))&&a.loadSnapshot(e[c])};var l=0;a.on("change",function(){clearTimeout(l);l=setTimeout(function(){a.backup()},3E3)});c.innerHTML='<select style="margin-top:-5px;" id="backuper_'+a.name+'"></select>&nbsp;<input type="image" value="del" onclick="CKEDITOR.instances[\''+a.name+"'].backup('del'); return false;\" src=\""+CKEDITOR.basePath+'plugins/backup/clear.png"/>';c.onchange=a.restore;
CKEDITOR.document.getById(a.ui.spaceId?a.ui.spaceId("bottom"):"cke_bottom_"+a.name).append(new CKEDITOR.dom.node(c));h=CKEDITOR.document.getById("backuper_"+a.name);a.backup()})}});